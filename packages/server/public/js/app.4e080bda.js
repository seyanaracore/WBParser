(function(){"use strict";var t={9423:function(t,s,a){var e=a(3972),n=function(){var t=this,s=t._self._c,a=t._self._setupProxy;return s("div",{attrs:{id:"app"}},[s("nav",{staticClass:"nav small nav-tabs"},[s("a",{staticClass:"nav-link",class:{active:a.page},attrs:{href:"#"},on:{click:function(t){a.page=!0}}},[t._v("Main")]),s("a",{staticClass:"nav-link",class:{active:!a.page},attrs:{href:"#"},on:{click:function(t){a.page=!1}}},[t._v("Settings")])]),s("main",[s("KeepAlive",[a.page?s(a.MainPage):s(a.SettingsPage)],1)],1)])},o=[],r=function(){var t=this,s=t._self._c,a=t._self._setupProxy;return s("main",{staticClass:"container mt-4"},[s("h3",[t._v("Главная")]),s("div",{staticClass:"mt-3 bd-example"},[a.isParsing?s("button",{staticClass:"btn btn-primary",on:{click:a.stopParsingHandler}},[a.parseStopping?s(a.Loader,{attrs:{msg:"Остановка..."}}):s("span",[t._v("Остановить парсинг")])],1):s("button",{staticClass:"btn btn-primary",on:{click:a.startParseHandler}},[a.parseStarting?s(a.Loader,{attrs:{msg:"Запуск..."}}):s("span",[t._v("Запустить парсинг")])],1)]),a.logs.length?s("table",{staticClass:"table mt-5"},[t._m(0),s("tbody",t._l(a.logs,(function(a,e){return s("tr",{key:a.value+e},[s("td",{class:{"text-danger":!a.type,"text-secondary":!!a.type}},[t._v(" "+t._s(a.value)+" ")])])})),0)]):s("div",[s("hr"),s("p",[t._v("Здесь будут логи")])]),s(a.Toast,{attrs:{message:a.toastMessage},on:{closeToast:a.closeToast}})],1)},i=[function(){var t=this,s=t._self._c;t._self._setupProxy;return s("thead",[s("tr",[s("th",{attrs:{scope:"col"}},[t._v("Логи")])])])}];a(1951);const c=t=>{const s=(0,e.iH)(!1),a=(0,e.iH)(null),n=async()=>{try{return a.value=null,s.value=!0,await t()}catch(e){return console.error(e),a.value=e.message,e}finally{s.value=!1}};return[n,s,a]};var l=c,u=a(7459);const d=9e3,v=3030,p=`http://localhost:${v}`,g=`http://localhost:${d}`;var m=a(3924);class f{static async getSettings(){const t=await u.Z.get(`${p}/settings`);return t.data}static async getConstants(){const t=await u.Z.get(`${p}/constants`);return t.data}static async setConstants(t){const s=await u.Z.post(`${p}/constants`,t);return s.data}static async setSettings(t){const s=await u.Z.post(`${p}/settings`,t);return s.data}static async restoreConstants(){const t=await u.Z.get(`${p}/constants`,{params:{restore:!0}});return t.data}static async restoreSettings(){const t=await u.Z.get(`${p}/settings`,{params:{restore:!0}});return t.data}static async startParse(t=null){const s=await u.Z.post(`${p}/parser`,t);return s.data}static async stopParse(){const t=await u.Z.get(`${p}/parser`,{params:{stop:!0}});return t.data}static async isParsing(){const t=await u.Z.get(`${p}/parser`,{params:{isParsing:!0}});return t.data}static async connectLogsSocket(){return(0,m.io)(g,{transports:["websocket","polling"]})}}var _=f,y=function(){var t=this,s=t._self._c;t._self._setupProxy;return s("span",{staticClass:"loader"},[s("span",{staticClass:"label"},[t._v(t._s(t.msg))]),s("div",{staticClass:"spinner-border",attrs:{role:"status"}},[s("span",{staticClass:"visually-hidden"},[t._v(t._s(t.msg))])])])},P=[],b={__name:"Loader",props:{msg:{type:String,required:!1,default:"Загрузка"}},setup(t){return{__sfc:!0}}},h=b,C=a(3483),S=(0,C.Z)(h,y,P,!1,null,"210704b9",null),T=S.exports,x=function(){var t=this,s=t._self._c;return s("div",{staticClass:"toast-container position-fixed bottom-0 end-0 p-3"},[s("div",{staticClass:"toast",class:{show:t.message},attrs:{id:"liveToast",role:"alert","aria-live":"assertive","aria-atomic":"true"}},[s("div",{staticClass:"toast-header"},[s("strong",{staticClass:"me-auto"},[t._v("Уведомление")]),s("button",{staticClass:"btn-close",attrs:{type:"button","data-bs-dismiss":"toast","aria-label":"Close"},on:{click:function(s){return t.$emit("closeToast")}}})]),s("div",{staticClass:"toast-body"},[t._v(t._s(t.message))])])])},w=[],k={props:{message:{type:String,required:!0}}},E=k,N=(0,C.Z)(E,x,w,!1,null,null,null),O=N.exports;const $=()=>{const t=(0,e.iH)(""),s=(s=null,a=4e3)=>{if("string"!==typeof s)throw Error("Сообщение ожидает строку");t.value=s,setTimeout((()=>{t.value=""}),a)},a=()=>{t.value=""};return[s,a,t]};var A=$,R={__name:"MainPage",setup(t){const s=(0,e.iH)([]),a=(0,e.iH)(!1),n=(0,e.iH)(null),[o,r]=l(_.startParse),[i,c]=l(_.stopParse),[u,d,v]=A(),p=async()=>{n.value=await _.connectLogsSocket(),n.value.on("connect",(()=>{u("Сокет установлен")})),n.value.on("log",(t=>{s.value.unshift(t)})),n.value.on("finish",(t=>{u("Finish"),setTimeout((()=>{m()}),200)})),n.value.on("close",(()=>{u("Сокет закрыт")})),n.value.on("error",(()=>{setTimeout((()=>{n.value.close()}),100)}))},g=async()=>{await o(),a.value=!0,s.value.length&&(s.value=[]),n.value||p()},m=async()=>{n.value&&(await n.value.close(),n.value=null),await i(),a.value=!1};return _.isParsing().then((t=>{a.value=t,t&&p()})),{__sfc:!0,logs:s,isParsing:a,ws:n,startParse:o,parseStarting:r,stopParsing:i,parseStopping:c,showToast:u,closeToast:d,toastMessage:v,connectLogsSocket:p,startParseHandler:g,stopParsingHandler:m,Loader:T,Toast:O}}},M=R,Z=(0,C.Z)(M,r,i,!1,null,null,null),L=Z.exports,G=function(){var t=this,s=t._self._c,a=t._self._setupProxy;return s("div",{staticClass:"d-flex flex-column mt-4 container"},[a.isLoadingSettings||a.isLoadingConstants?s(a.Loader,{attrs:{msg:"Загрузка..."}}):s("div",[s("form",{staticClass:"settings",on:{submit:a.onSubmitSettings,reset:a.onResetSettings}},[s("h3",[t._v("Настройки")]),t._l(Object.keys(a.data.settings),(function(e){return s("div",{key:e,staticClass:"input-group input-group mt-2"},[s("span",{directives:[{name:"tooltip",rawName:"v-tooltip.top-center",value:a.data.settings[e].description,expression:"data.settings[settingKey].description",modifiers:{"top-center":!0}}],staticClass:"input-group-text",attrs:{id:"inputGroup-sizing"}},[t._v(" "+t._s(a.data.settings[e].name)+" ")]),"checkbox"===(a.SETTINGS_NUMBERS_VALUE.includes(e)?"number":"text")&&"sorting"!==e?s("input",{directives:[{name:"model",rawName:"v-model",value:a.data.settings[e].value,expression:"data.settings[settingKey].value"}],staticClass:"form-control",attrs:{max:"productsCountPerPage"===e&&a.data.constants.PRODUCTS_PER_PAGE_MAX?.value||"includePrevProducts"===e&&1,min:"includePrevProducts"===e&&0,placeholder:"Все",type:"checkbox"},domProps:{checked:Array.isArray(a.data.settings[e].value)?t._i(a.data.settings[e].value,null)>-1:a.data.settings[e].value},on:{change:function(s){var n=a.data.settings[e].value,o=s.target,r=!!o.checked;if(Array.isArray(n)){var i=null,c=t._i(n,i);o.checked?c<0&&t.$set(a.data.settings[e],"value",n.concat([i])):c>-1&&t.$set(a.data.settings[e],"value",n.slice(0,c).concat(n.slice(c+1)))}else t.$set(a.data.settings[e],"value",r)}}}):"radio"===(a.SETTINGS_NUMBERS_VALUE.includes(e)?"number":"text")&&"sorting"!==e?s("input",{directives:[{name:"model",rawName:"v-model",value:a.data.settings[e].value,expression:"data.settings[settingKey].value"}],staticClass:"form-control",attrs:{max:"productsCountPerPage"===e&&a.data.constants.PRODUCTS_PER_PAGE_MAX?.value||"includePrevProducts"===e&&1,min:"includePrevProducts"===e&&0,placeholder:"Все",type:"radio"},domProps:{checked:t._q(a.data.settings[e].value,null)},on:{change:function(s){return t.$set(a.data.settings[e],"value",null)}}}):"sorting"!==e?s("input",{directives:[{name:"model",rawName:"v-model",value:a.data.settings[e].value,expression:"data.settings[settingKey].value"}],staticClass:"form-control",attrs:{max:"productsCountPerPage"===e&&a.data.constants.PRODUCTS_PER_PAGE_MAX?.value||"includePrevProducts"===e&&1,min:"includePrevProducts"===e&&0,placeholder:"Все",type:a.SETTINGS_NUMBERS_VALUE.includes(e)?"number":"text"},domProps:{value:a.data.settings[e].value},on:{input:function(s){s.target.composing||t.$set(a.data.settings[e],"value",s.target.value)}}}):s("select",{directives:[{name:"model",rawName:"v-model",value:a.data.settings[e].value,expression:"data.settings[settingKey].value"}],staticClass:"form-select",on:{change:function(s){var n=Array.prototype.filter.call(s.target.options,(function(t){return t.selected})).map((function(t){var s="_value"in t?t._value:t.value;return s}));t.$set(a.data.settings[e],"value",s.target.multiple?n:n[0])}}},t._l(a.data.constants.SORTING_TYPES.value,(function(a){return s("option",{key:a},[t._v(" "+t._s(a)+" ")])})),0)])})),s("div",{staticClass:"mt-3 d-flex"},[s("button",{staticClass:"btn btn-success",attrs:{type:"submit"}},[t._v("Сохранить")]),s("button",{staticClass:"btn btn-danger ms-2",attrs:{type:"reset"}},[t._v("Сброс")])])],2),s("form",{staticClass:"constants mt-4 pb-4",on:{submit:a.onSubmitConstants,reset:a.onResetConstants}},[s("h3",[t._v("Константы")]),t._l(Object.keys(a.data.constants),(function(e){return s("div",{key:e,staticClass:"input-group input-group mt-2"},[s("span",{directives:[{name:"tooltip",rawName:"v-tooltip.top-center",value:a.data.constants[e].description,expression:"data.constants[constantKey].description",modifiers:{"top-center":!0}}],staticClass:"input-group-text",attrs:{id:"inputGroup-sizing"}},[t._v(" "+t._s(a.data.constants[e].name)+" ")]),"checkbox"===("number"===typeof a.data.constants[e].value?"number":"text")&&"SORTING_TYPES"!==e?s("input",{directives:[{name:"model",rawName:"v-model",value:a.data.constants[e].value,expression:"data.constants[constantKey].value"}],staticClass:"form-control",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(a.data.constants[e].value)?t._i(a.data.constants[e].value,null)>-1:a.data.constants[e].value},on:{change:function(s){var n=a.data.constants[e].value,o=s.target,r=!!o.checked;if(Array.isArray(n)){var i=null,c=t._i(n,i);o.checked?c<0&&t.$set(a.data.constants[e],"value",n.concat([i])):c>-1&&t.$set(a.data.constants[e],"value",n.slice(0,c).concat(n.slice(c+1)))}else t.$set(a.data.constants[e],"value",r)}}}):"radio"===("number"===typeof a.data.constants[e].value?"number":"text")&&"SORTING_TYPES"!==e?s("input",{directives:[{name:"model",rawName:"v-model",value:a.data.constants[e].value,expression:"data.constants[constantKey].value"}],staticClass:"form-control",attrs:{type:"radio"},domProps:{checked:t._q(a.data.constants[e].value,null)},on:{change:function(s){return t.$set(a.data.constants[e],"value",null)}}}):s("input","SORTING_TYPES"!==e?{directives:[{name:"model",rawName:"v-model",value:a.data.constants[e].value,expression:"data.constants[constantKey].value"}],staticClass:"form-control",attrs:{type:"number"===typeof a.data.constants[e].value?"number":"text"},domProps:{value:a.data.constants[e].value},on:{input:function(s){s.target.composing||t.$set(a.data.constants[e],"value",s.target.value)}}}:{directives:[{name:"model",rawName:"v-model",value:a.sortingTypes,expression:"sortingTypes"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:a.sortingTypes},on:{input:function(t){t.target.composing||(a.sortingTypes=t.target.value)}}})])})),s("div",{staticClass:"mt-3 d-flex"},[s("button",{staticClass:"btn btn-success",attrs:{type:"submit"}},[t._v("Сохранить")]),s("button",{staticClass:"btn btn-danger ms-2",attrs:{type:"reset"}},[t._v("Сброс")])])],2)]),s(a.Toast,{attrs:{message:a.toastMessage},on:{closeToast:a.closeToast}})],1)},j=[],H={__name:"SettingsPage",setup(t){const[s,a,n]=A(),o=["initialIterationPage","pagesHandlingCount","productsCountPerPage","includePrevProducts"],r=(0,e.Fl)({get(){return i.constants.SORTING_TYPES.value.join(",")},set(t){i.constants.SORTING_TYPES.value=t.split(",")}}),i=(0,e.qj)({settings:{},constants:{}}),c=async()=>{i.settings=await _.getSettings()},u=async()=>{i.constants=await _.getConstants()},d=async t=>{t.preventDefault();try{await _.setSettings(i.settings),s("Настройки установлены")}catch(t){s(t.message)}},v=async t=>{t.preventDefault();try{await _.setConstants(i.constants),s("Константы установлены")}catch(t){s(t.message)}},p=async t=>{t.preventDefault();try{i.settings=await _.restoreSettings(),s("Настройки восстановлены")}catch(t){s("Ошибка восстановления настроек")}},g=async t=>{t.preventDefault();try{i.constants=await _.restoreConstants(),s("Константы восстановлены")}catch(t){s("Ошибка восстановления констант")}},[m,f]=l(c),[y,P]=l(u);try{m(),y()}catch(b){s(b.message)}return{__sfc:!0,showToast:s,closeToast:a,toastMessage:n,SETTINGS_NUMBERS_VALUE:o,sortingTypes:r,data:i,fetchSettings:c,fetchConstants:u,onSubmitSettings:d,onSubmitConstants:v,onResetSettings:p,onResetConstants:g,getSettings:m,isLoadingSettings:f,getConstants:y,isLoadingConstants:P,Loader:T,Toast:O}}},I=H,U=(0,C.Z)(I,G,j,!1,null,null,null),K=U.exports,D={__name:"App",setup(t){const s=(0,e.iH)(!0);return{__sfc:!0,page:s,MainPage:L,SettingsPage:K}}},Y=D,q=(0,C.Z)(Y,n,o,!1,null,null,null),B=q.exports,V=a(6150);e.ZP.use(V.ZP),e.ZP.config.productionTip=!1,new e.ZP({render:t=>t(B)}).$mount("#app")}},s={};function a(e){var n=s[e];if(void 0!==n)return n.exports;var o=s[e]={id:e,loaded:!1,exports:{}};return t[e](o,o.exports,a),o.loaded=!0,o.exports}a.m=t,function(){var t=[];a.O=function(s,e,n,o){if(!e){var r=1/0;for(u=0;u<t.length;u++){e=t[u][0],n=t[u][1],o=t[u][2];for(var i=!0,c=0;c<e.length;c++)(!1&o||r>=o)&&Object.keys(a.O).every((function(t){return a.O[t](e[c])}))?e.splice(c--,1):(i=!1,o<r&&(r=o));if(i){t.splice(u--,1);var l=n();void 0!==l&&(s=l)}}return s}o=o||0;for(var u=t.length;u>0&&t[u-1][2]>o;u--)t[u]=t[u-1];t[u]=[e,n,o]}}(),function(){a.n=function(t){var s=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(s,{a:s}),s}}(),function(){a.d=function(t,s){for(var e in s)a.o(s,e)&&!a.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:s[e]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){a.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};a.O.j=function(s){return 0===t[s]};var s=function(s,e){var n,o,r=e[0],i=e[1],c=e[2],l=0;if(r.some((function(s){return 0!==t[s]}))){for(n in i)a.o(i,n)&&(a.m[n]=i[n]);if(c)var u=c(a)}for(s&&s(e);l<r.length;l++)o=r[l],a.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return a.O(u)},e=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];e.forEach(s.bind(null,0)),e.push=s.bind(null,e.push.bind(e))}();var e=a.O(void 0,[998],(function(){return a(9423)}));e=a.O(e)})();
//# sourceMappingURL=app.4e080bda.js.map